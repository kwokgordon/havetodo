<script>

/////////////////////////////////////////////////////////////////////////
function toggleCheckbox(id) {

	$.ajax({
      type: "POST",
      url: "/users/tasks/" +id + "/toggleComplete.json",
      success: function(response) {
      	
	    var taskElement = document.getElementById('task_'+id);
	    var taskDateElement = document.getElementById('item_datetime_'+id);
 	    if(taskElement.getAttribute('class') == "completed") {
    	  taskElement.setAttribute('class', 'incomplete');
	      taskDateElement.innerHTML = response.due_date;
		  document.getElementById(id).src = "<%= image_path("uncheck.png") %>";
		  
	    } else {
	      taskElement.setAttribute('class', 'completed');
	      taskDateElement.innerHTML = response.completed_date;
		  document.getElementById(id).src = "<%= image_path("check.png") %>";

	    }
    
//        setInterval("location.reload()", 5000);

      }
    });

}

/////////////////////////////////////////////////////////////////////////

$(document).ready(function(){

  if($.cookie('show_details') == "true") {
    show_details();
  } else {
    hide_details();
  }

  $("#add_details_button").click(function(){
  	if($("#add_details_button").text() == "Show Details") {
      show_details();
  	} else {
  	  hide_details();
  	}
  });
});

/////////////////////////////////////////////////////////////////////////

$('[data-toggle="popover"]').popover();

function deleteTask(id) {
  var titleHtml = [
    '<span class="text-info"><strong>Confirm Delete?</strong></span>'
  ].join('\n');

  var contentHtml = [
    '<div>',
      '<button class="btn btn-link cancel">Cancel</button>',
      '<button class="btn btn-primary delete">Delete</button>',
    '</div>'].join('\n');
    
  $('[data-toggle="popover"]').each( function() {
    $(this).popover().popover('hide');
  });
    
  $('body').click(function(event) {
    $("#task_delete_"+id).popover({
      placement: 'bottom',
      html: 'true',
      title : titleHtml,
      content : contentHtml
    }).popover('show');
  })
}

/*

$('body').on('click', function (e) {
    $('[data-toggle="popover"]').each(function () {
        //the 'is' for buttons that trigger popups
        //the 'has' for icons within a button that triggers a popup
        if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
            $(this).popover('hide');
        }
    });
});
*/

/////////////////////////////////////////////////////////////////////////
function show_details() {
  $("#add_details_block").show();
  $("#add_details_button").text("Hide Details");

  $.cookie('show_details', "true");
  grab_cookies_details();
}

function hide_details() {
  $("#add_details_block").hide();
  $("#add_details_button").text("Show Details");
  
  $.cookie('show_details', "false");
  set_default_details();
  grab_cookies_details();
}

function set_default_details() {
  var today = new Date();
  var dd = today.getDate();
  var mm = today.getMonth()+1; //January is 0!

  var yyyy = today.getFullYear();
  if(dd<10){dd='0'+dd} if(mm<10){mm='0'+mm} today = yyyy+'-'+mm+'-'+dd;

  $.cookie('note', "");
  $.cookie('due_date', today);
  $.cookie('due_time', "");
}

function grab_cookies_details() {
  $("#task_note").val($.cookie("note"));
  $("#task_due_date").val($.cookie("due_date"));
  $("#task_due_time").val($.cookie("due_time"));
}

/////////////////////////////////////////////////////////////////////////

</script>
